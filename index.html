<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TubeFlow Ultimate Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #000; color: #fff; font-family: Roboto, sans-serif; overflow: hidden; margin: 0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Navigation mit Blur */
        .glass-nav {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
        }

        /* Player Slide Animation */
        #player-overlay { transform: translateY(100%); transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1); }
        #player-overlay.active { transform: translateY(0); }

        /* Shorts Scroll-System */
        .shorts-container {
            height: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
        }
        .short-video {
            height: 100%;
            scroll-snap-align: start;
            position: relative;
            background: #000;
        }

        .tab-content { display: none; height: calc(100vh - 130px); overflow-y: auto; }
        .tab-content.active { display: block; }
        .tab-content#shorts { height: calc(100vh - 70px); } /* Shorts brauchen mehr Platz */
    </style>
</head>
<body class="flex flex-col h-screen">

    <header class="flex items-center justify-between px-4 py-3 bg-black z-50">
        <div class="flex items-center gap-1" onclick="showTab('home')">
            <i class="fab fa-youtube text-red-600 text-3xl"></i>
            <span class="text-xl font-bold tracking-tighter italic">TubeFlow</span>
        </div>
        <div class="flex items-center gap-5">
            <i class="fas fa-search text-xl" onclick="document.getElementById('searchBar').classList.toggle('hidden')"></i>
            <div onclick="showTab('profile')" class="w-8 h-8 bg-gradient-to-tr from-blue-500 to-purple-600 rounded-full flex items-center justify-center font-bold text-xs cursor-pointer">U</div>
        </div>
    </header>

    <div id="searchBar" class="hidden px-4 py-2 bg-black border-b border-zinc-800">
        <form onsubmit="event.preventDefault(); search();">
            <input type="text" id="searchInput" placeholder="YouTube durchsuchen..." class="w-full bg-zinc-900 rounded-full px-4 py-2 outline-none text-sm border border-zinc-700">
        </form>
    </div>

    <main class="flex-1 overflow-hidden">
        <section id="home" class="tab-content active no-scrollbar">
            <div id="videoGrid" class="flex flex-col gap-1 p-0"></div>
        </section>

        <section id="shorts" class="tab-content no-scrollbar p-0">
            <div id="shortsContainer" class="shorts-container no-scrollbar">
                </div>
        </section>

        <section id="subs" class="tab-content p-4">
            <h2 class="text-xl font-bold mb-4">Abonnements</h2>
            <div id="subsList" class="space-y-3"></div>
        </section>

        <section id="profile" class="tab-content p-6">
            <div class="text-center mb-10">
                <div class="w-20 h-20 bg-gradient-to-tr from-blue-500 to-purple-600 rounded-full mx-auto mb-3 flex items-center justify-center text-2xl font-bold">U</div>
                <h2 class="text-xl font-bold">Mein Account</h2>
                <div class="flex gap-2 justify-center mt-4">
                   <button onclick="exportData()" class="bg-zinc-800 px-4 py-2 rounded-lg text-xs font-bold">Export</button>
                   <button onclick="importData()" class="bg-zinc-800 px-4 py-2 rounded-lg text-xs font-bold">Import</button>
                </div>
            </div>
            <div class="space-y-4">
                <div class="bg-zinc-900 p-4 rounded-xl flex justify-between"><span>Abos</span><span id="stat-subs">0</span></div>
                <div class="bg-zinc-900 p-4 rounded-xl flex justify-between"><span>Likes</span><span id="stat-likes">0</span></div>
            </div>
        </section>
    </main>

    <nav class="fixed bottom-0 w-full glass-nav border-t border-zinc-900 flex justify-around pt-3 pb-8 z-40">
        <div onclick="showTab('home')" class="flex flex-col items-center gap-1 text-[10px] text-zinc-400 cursor-pointer">
            <i class="fas fa-house text-lg"></i><span>Home</span>
        </div>
        <div onclick="showTab('shorts')" class="flex flex-col items-center gap-1 text-[10px] text-zinc-400 cursor-pointer">
            <i class="fas fa-bolt text-lg"></i><span>Shorts</span>
        </div>
        <div class="flex flex-col items-center justify-center -mt-2"><i class="fas fa-circle-plus text-3xl"></i></div>
        <div onclick="showTab('subs')" class="flex flex-col items-center gap-1 text-[10px] text-zinc-400 cursor-pointer">
            <i class="fas fa-layer-group text-lg"></i><span>Abos</span>
        </div>
        <div onclick="showTab('profile')" class="flex flex-col items-center gap-1 text-[10px] text-zinc-400 cursor-pointer">
            <i class="fas fa-user-circle text-lg"></i><span>Profil</span>
        </div>
    </nav>

    <div id="player-overlay" class="fixed inset-0 bg-black z-[60] flex flex-col">
        <div class="p-2" onclick="closePlayer()"><i class="fas fa-chevron-down p-4 text-xl"></i></div>
        <div class="w-full aspect-video"><iframe id="main-player" width="100%" height="100%" frameborder="0" allowfullscreen allow="autoplay"></iframe></div>
        <div class="flex-1 overflow-y-auto p-5">
            <h1 id="player-title" class="text-lg font-bold">Titel</h1>
            <div class="flex items-center justify-between mt-4 pb-4 border-b border-zinc-800">
                <div class="flex items-center gap-3">
                    <img id="player-chan-img" src="" class="w-10 h-10 rounded-full bg-zinc-800">
                    <p id="player-channel" class="font-bold text-sm">Channel</p>
                </div>
                <button id="subBtn" onclick="toggleSub()" class="bg-white text-black px-4 py-2 rounded-full text-xs font-bold">Abonnieren</button>
            </div>
            <div id="commentsList" class="mt-6 space-y-4"></div>
        </div>
    </div>

    <script>
        const API = "https://inv.vern.cc/api/v1";
        let db = JSON.parse(localStorage.getItem('tubeflow_v3')) || { subs: [], likes: [], history: [] };
        let activeVideo = null;

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            if(tabId === 'shorts') loadShorts();
            if(tabId === 'subs') renderSubs();
            document.getElementById('searchBar').classList.add('hidden');
        }

        async function search(q = "Musik") {
            const query = document.getElementById('searchInput').value || q;
            const grid = document.getElementById('videoGrid');
            grid.innerHTML = '<div class="p-10 text-center">Lade...</div>';
            showTab('home');

            try {
                const res = await fetch(`${API}/search?q=${encodeURIComponent(query)}`);
                const data = await res.json();
                grid.innerHTML = data.filter(v => v.type === 'video').map(v => `
                    <div class="mb-4" onclick="openPlayer('${v.videoId}', '${v.title.replace(/'/g,"")}', '${v.author}')">
                        <img src="${v.videoThumbnails[0].url}" class="w-full aspect-video object-cover">
                        <div class="flex gap-3 p-3">
                            <img src="https://ui-avatars.com/api/?name=${v.author}&background=random" class="w-10 h-10 rounded-full">
                            <div>
                                <h3 class="text-sm font-medium line-clamp-2">${v.title}</h3>
                                <p class="text-zinc-500 text-[11px]">${v.author} â€¢ ${v.viewCountText}</p>
                            </div>
                        </div>
                    </div>`).join('');
            } catch(e) { console.error(e); }
        }

        async function loadShorts() {
            const container = document.getElementById('shortsContainer');
            container.innerHTML = '<div class="h-screen flex items-center justify-center">Lade Shorts...</div>';
            try {
                const res = await fetch(`${API}/search?q=Shorts+Funny`);
                const data = await res.json();
                container.innerHTML = data.filter(v => v.type === 'video').map(v => `
                    <div class="short-video">
                        <iframe width="100%" height="100%" src="https://www.youtube.com/embed/${v.videoId}?autoplay=0&controls=0&loop=1" frameborder="0"></iframe>
                        <div class="absolute bottom-20 left-4 z-10">
                            <h3 class="font-bold text-sm shadow-lg">${v.author}</h3>
                            <p class="text-xs line-clamp-1">${v.title}</p>
                        </div>
                        <div class="absolute bottom-24 right-4 z-10 flex flex-col gap-6 text-xl">
                            <i class="fas fa-thumbs-up"></i>
                            <i class="fas fa-comment"></i>
                            <i class="fas fa-share"></i>
                        </div>
                    </div>`).join('');
            } catch(e) { container.innerHTML = "Fehler beim Laden der Shorts."; }
        }

        function openPlayer(id, title, channel) {
            activeVideo = { id, title, channel };
            document.getElementById('main-player').src = `https://www.youtube.com/embed/${id}?autoplay=1`;
            document.getElementById('player-title').innerText = title;
            document.getElementById('player-channel').innerText = channel;
            document.getElementById('player-chan-img').src = `https://ui-avatars.com/api/?name=${channel}&background=random`;
            document.getElementById('player-overlay').classList.add('active');
            loadComments(id);
        }

        async function loadComments(id) {
            const list = document.getElementById('commentsList');
            list.innerHTML = 'Kommentare laden...';
            try {
                const res = await fetch(`${API}/comments/${id}`);
                const data = await res.json();
                list.innerHTML = data.comments.slice(0, 10).map(c => `
                    <div class="flex gap-3 text-xs">
                        <img src="https://ui-avatars.com/api/?name=${c.author}&size=32" class="w-8 h-8 rounded-full">
                        <div><p class="font-bold">${c.author}</p><p class="text-zinc-400">${c.content}</p></div>
                    </div>`).join('');
            } catch(e) { list.innerHTML = ''; }
        }

        function toggleSub() {
            const idx = db.subs.indexOf(activeVideo.channel);
            if(idx > -1) db.subs.splice(idx, 1);
            else db.subs.push(activeVideo.channel);
            localStorage.setItem('tubeflow_v3', JSON.stringify(db));
            alert(db.subs.includes(activeVideo.channel) ? "Abonniert!" : "Abo entfernt!");
        }

        function renderSubs() {
            document.getElementById('subsList').innerHTML = db.subs.map(s => `
                <div class="flex items-center justify-between bg-zinc-900 p-4 rounded-xl">
                    <div class="flex items-center gap-3">
                        <img src="https://ui-avatars.com/api/?name=${s}&background=random" class="w-8 h-8 rounded-full">
                        <span class="font-bold">${s}</span>
                    </div>
                    <i class="fas fa-bell"></i>
                </div>`).join('') || "Keine Abos";
        }

        function closePlayer() {
            document.getElementById('player-overlay').classList.remove('active');
            document.getElementById('main-player').src = "";
        }

        search();
    </script>
</body>
</html>
